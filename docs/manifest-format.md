# Manifest Format

The SDAAS.io manifest is the canonical machine-readable record of a synthetic dataset certificate. It is the primary artifact for independent verification.

---

## Envelope

Every manifest response includes a signature envelope:

```json
{
  "schema_version": "sdaas.manifest.v1",
  "payload": { ... },
  "signature": {
    "alg": "Ed25519",
    "key_id": "ed25519-prod-2025-02",
    "value": "<base64url-encoded signature>"
  }
}
```

| Field | Description |
|-------|-------------|
| `schema_version` | Always `"sdaas.manifest.v1"` |
| `payload` | The certificate payload that was signed (see below) |
| `signature.alg` | Signing algorithm — currently `"Ed25519"` or `"HMAC-SHA256"` (legacy) |
| `signature.key_id` | Key identifier — use this to fetch the public key from `/.well-known/signing-keys.json` |
| `signature.value` | Base64url-encoded signature bytes |

---

## Payload (`cert.v1` schema)

The `payload` object follows the `sdaas.cert.v1` JSON Schema:

```json
{
  "schema_version": "sdaas.cert.v1",
  "cert_id": "uuid",
  "issued_at": "2025-06-01T12:00:00.000Z",
  "issuer": "SDAAS.io",
  "environment": "production",
  "subject": {
    "dataset_name": "Customer Records — Synthetic",
    "row_count": 1000,
    "column_count": 12,
    "format": "csv",
    "generation_model": "CTGAN"
  },
  "attestations": [
    "Generated by SDAAS.io platform",
    "No real personal data used in generation"
  ],
  "hashes": {
    "payload_sha256": "<sha256 of canonical payload bytes — excluding this field>",
    "datasets": {
      "customers.csv": {
        "sha256": "<sha256 of the dataset file>",
        "size_bytes": 48200,
        "row_count": 1000
      }
    }
  },
  "signature_alg": "Ed25519",
  "signing_key_id": "ed25519-prod-2025-02"
}
```

### Required fields

| Field | Type | Description |
|-------|------|-------------|
| `schema_version` | string | Always `"sdaas.cert.v1"` |
| `cert_id` | string (UUID) | Unique certificate identifier |
| `issued_at` | string (ISO 8601) | Issuance timestamp |
| `issuer` | string | Always `"SDAAS.io"` |
| `environment` | string | `"production"` or `"development"` |
| `subject` | object | Dataset metadata |
| `attestations` | string[] | What the certificate attests |
| `hashes.payload_sha256` | string | SHA-256 of the canonical payload (for integrity check) |
| `signature_alg` | string | Algorithm used to sign |
| `signing_key_id` | string | Key ID used to sign |

### Optional fields

| Field | Type | Description |
|-------|------|-------------|
| `hashes.datasets` | object | Per-file SHA-256 hashes, row counts, and sizes |
| `subject.generation_model` | string | Synthetic generation method |
| `subject.format` | string | Output file format |

---

## Fetching a Manifest

```bash
# By certificate ID
GET https://sdaas.io/api/cert/{cert_id}/manifest

# Response
{
  "schema_version": "sdaas.manifest.v1",
  "payload": { ... },
  "signature": { "alg": "Ed25519", "key_id": "...", "value": "..." }
}
```

---

## Verification Flow

1. **Fetch** the manifest envelope from `/api/cert/{id}/manifest`
2. **Fetch** the public key from `/.well-known/signing-keys.json` matching `signature.key_id`
3. **Canonicalize** `payload` using `json-stable-stringify` + UTF-8 encode (see [canonicalization.md](./canonicalization.md))
4. **Verify** the Ed25519 signature: `verify(public_key, canonical_bytes, base64url_decode(signature.value))`
5. **Check** `payload.hashes.payload_sha256` matches SHA-256 of the canonical bytes
6. (Optional) **Check** `payload.hashes.datasets` against your local copies of the dataset files

A certificate is valid if and only if step 4 returns `true`.

---

## Public Keys Endpoint

```bash
GET https://sdaas.io/.well-known/signing-keys.json

{
  "keys": [
    {
      "key_id": "ed25519-prod-2025-02",
      "algorithm": "Ed25519",
      "public_key_pem": "-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----",
      "status": "active",
      "created_at": "2025-02-15T00:00:00Z"
    }
  ],
  "issuer": "SDAAS.io",
  "documentation": "https://sdaas.io/security-and-certification-faq"
}
```

---

## Schema Validation

The full JSON Schema for `cert.v1` is available at:

- `packages/schema-gen/` in this repository
- Or fetch at runtime from the schema registry (TBD)

---

## See Also

- [Canonicalization](./canonicalization.md)
- [Key Rotation](./key-rotation.md)
- [`@sdaas/verify` package](../packages/verify/)
- [Verification Framework (web)](https://sdaas.io/verification-framework)
